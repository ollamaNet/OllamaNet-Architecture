@startuml
!theme plain
skinparam sequence {
    ArrowColor #666666
    ActorBorderColor #666666
    LifeLineBorderColor #666666
    ParticipantBorderColor #666666
    ParticipantBackgroundColor #EEEEEE
}

actor User
participant "API Gateway" as gateway
participant "Auth Service" as auth
participant "Chat Service" as chat
participant "Conversation Service" as conv
participant "LLM Inference Service" as llm
participant "Cache Service" as cache

User -> gateway: Send Message Request
activate gateway
gateway -> auth: Validate Token
activate auth
auth --> gateway: Token Valid
deactivate auth
gateway -> chat: Process Message
activate chat
chat -> conv: Get Conversation Context
activate conv
conv --> chat: Context Data
deactivate conv
chat -> llm: Generate Response
activate llm
llm --> chat: Response
deactivate llm
chat -> cache: Cache Response
activate cache
cache --> chat: Cached
deactivate cache
chat --> gateway: Response
deactivate chat
gateway --> User: Message Response
deactivate gateway

@enduml
